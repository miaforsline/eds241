---
title: "EDS 241 Assignment 2"
author: "Mia Forsline"
date: "2/4/2022"
output: 
  html_document:
    theme: flatly
    code_folding: hide
    toc: true
    toc_float: true
    number_sections: false 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE, 
                      warning = FALSE)
```

# Set Up 

```{r}
packages=c("cowplot",
           "datasets", 
           "dplyr",
           "estimatr",
           "here", 
           "ggplot2",
           "janitor",
           "stargazer", 
           "stringr",
           "tibble",
           "tidyverse",
           "tidyr", 
           "tinytex"
           )

for (i in packages) {
  if (require(i,character.only=TRUE)==FALSE) {
    install.packages(i,repos='http://cran.us.r-project.org')
  }
  else {
    require(i,character.only=TRUE)
  }
}

options(scipen=999) # not scientific notation
```

# Read in data 
- `fips`: FIPS code identifying each county
- `NPB`: 1 indicates if the county was regulated under the NO~x~ Budget Program 
- `PctBlack`: fraction of the county population that is African American
- `Dnox_masstons`: change in annual NO~x~ emissions from all power plants in a county between 2000 - 2008 in tons 
  - if `Dnox_masstons` < 0, then the NO~x~ emissions from power plants declined in that county 
```{r}
data <- readxl::read_excel(here("data", "NBP.xls"))

data_clean <- data %>% 
  janitor::clean_names()
```

# (a) Make a histogram depicting the distribution of Dnox_masstons.

```{r}
nox_lab <- expression(paste("Change in annual NOx"["3"]," emissions from 2000 - 2008 (tons)"))

ggplot(data = data_clean, aes(x = dnox_masstons)) + 
  geom_histogram() + 
  theme_classic() + 
  labs(x = nox_lab, 
       y = "Frequency")
```


# (b) Create an indicator =1 if the county has PctBlack above the sample median, and =0 otherwise (in the rest of the assignment, I refer to this variable as ‘D’). What is the average of PctBlack for counties above the median, i.e. counties for which D=1?

```{r}
median <- median(data_clean$pct_black)

data_d <- data_clean %>% 
  mutate(D = case_when(
    pct_black > median ~ 1,
    pct_black <= median ~ 0)
    )

data_above_median <- subset(data_d, D == 1)
avg_pct_black <- mean(data_above_median$pct_black)
```

For counties with a percentage of Black residents above the median, the average percentage of Black individuals is `r avg_pct_black`. 

# (c) Estimate a regression of Dnox_masstons on NBP. Interpret the estimated intercept and the coefficient on NBP.

```{r}
lm_robust(dnox_masstons ~ nbp, data = data_d)
```


# (d) Create an interaction between the variables NBP and D. Estimate a regression of Dnox_masstons on NBP, D, and this interaction. Interpret each estimated regression coefficient, including the intercept.

# (e) What is the predicted Dnox_masstons in a county that was not regulated under NBP and where PctBlack is above the sample median (i.e., where D=1)? Report the 95% confidence interval for this prediction. Make sure to use “heteroskedasticity-robust” standard errors.

